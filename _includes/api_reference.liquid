{% assign spec = site.data.openapi_spec %}
{% comment %} {% assign spec = site.data.petstore_spec %} {% endcomment %}

<div class="wrapper">
  <div class="schema-toc">
    <div class="schema-toc_paths">
      {% for path_item in spec.paths %}
        {% assign path = path_item[0] %}
        {% assign methods = path_item[1] %}
        
        {% for method_item in methods %}
          {% assign method = method_item[0] %}
          {% assign operation = method_item[1] %}
          <div class="schema-toc_link">
            <a href="#{{ method }}{{ path }}"><span class="schema-toc_prefix-{{ method }}">{{ method | upcase}}</span> {{ path }}</a>
          </div>
        {% endfor %}
      {% endfor %}
    </div>
  </div>

  <div class="schema_wrapper">
    <!-- Рендеринг обязательных параметров схемы: заголовок,версия и описание API -->
    <h1 class="api-title">{{ spec.info['title'] }} </h1>
    <div class="api-version">Версия API: {{ spec.info['version'] }}</div>
    {% if spec.info.description %}
      <div class="api-description">
        <div class="api-description_title">Описание API:</div>
        <div class="api-description_content">{{ spec.info['description'] | markdownify }}</div>
      </div>
    {% endif %}
    <!-- Рендеринг необязательных параметров схемы: список серверов -->
    {% if spec.servers %}
    <div class="api-servers">
      <div class="api-servers_title">Список серверов:</div>
      {% for server in spec.servers %}
      <div class="api-servers_item">
        {% if server.description %}
          {{ server['description'] }}:
        {% endif %}
        {% if server.url %}
          {{ server['url'] }}
        {% endif %}
      </div>
      {% endfor %}
    </div>
    {% endif %}
    <!-- Рендеринг эндпоинтов -->
    <div class="api-paths">
      <h2>Список конечных точек</h2>
      {% for path_item in spec.paths %}
        {% assign path = path_item[0] %}
        {% assign methods = path_item[1] %}
        
        {% for method_item in methods %}
          {% assign method = method_item[0] %}
          {% assign operation = method_item[1] %}
          
          <div class="api-paths_endpoint" id="{{ method }}{{ path }}">
            <!-- Рендеринг названий эндпоинтов -->
            <div class="{{ method }}"><a href="#{{ method }}{{ path }}"><span class="schema-toc_prefix-{{ method }}">{{ method | upcase}}</span> {{ path }}</a></div>
            <!-- Рендеринг краткого описания (summary) эндпоинтов -->
            {% if operation.summary %}
              <div class="api-paths__endpoint-summary">{{ operation.summary }}</div>
            {% endif %}
            <!-- Рендеринг описания (description) эндпоинтов -->
            {% if operation.description %}
              <div class="api-paths__endpoint-description">{{ operation.description }}</div>
            {% endif %}
            <!-- Рендеринг параметров эндпоинтов -->
            {% if operation.parameters %}
              <div class="api-paths__parameters">
                <div class="api-paths__parameters-list">Параметры:</div>
                <div class="parameters-table">
                  <table>
                    <thead>
                      <tr>
                        <th>№</th>
                        <th>Параметр</th>
                        <th>Тип</th>
                        <th>Расположение</th>
                        <th>Обязательный</th>
                        <th>Описание</th>
                      </tr>
                    </thead>
                    <tbody>
                    {% for parameter in operation.parameters %}
                      <tr>
                        <td>{{ forloop.index }}</td>
                        <td><strong>{{ parameter.name }}</strong></td>
                        <td><code>{{ parameter.schema['type'] }}</code></td>
                        <td>{{ parameter.in }}</td>
                        <td>{% if parameter.required %}<b>Да</b>{% else %}Нет{% endif %}</td>
                        <td>{% if parameter.description %}{{ parameter.description | strip }}{% endif %}</td>
                      </tr>
                    {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
            {% endif %}
          </div>
        {% endfor %}
      {% endfor %}
    </div>
  </div>
</div>
